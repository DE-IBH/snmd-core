define(["jquery","paho","js-logger"],function(t,n,i){"use strict";var e=null,s=function(){if(null!==e)throw new Error("Cannot instantiate more than one instance, use getInstance()!");this.client=void 0,this.flashTO=void 0,this.reconnTO=void 0,this.topics={}};return s.getInstance=function(){return null===e&&(e=new s),e},s.prototype.srReconnect=function(){i.debug("[MQTT] Reconnecting..."),this.srConnect()},s.prototype.srRegisterTopic=function(t,n){"undefined"==typeof this.topics&&(this.topics={}),"undefined"==typeof this.topics[t]?(this.topics[t]=[n],"undefined"!=typeof this.client&&this.client.isConnected()&&this.client.subscribe(t)):this.topics[t].push(n)},s.prototype.srStatus=function(n){t("#snmd-hb").css("background",n)},s.prototype.srConnect=function(){this.srStatus("yellow"),i.debug("[MQTT] Connecting to broker at "+this.broker_host+":"+this.broker_port+"..."),this.client=new n.MQTT.Client(this.broker_host,this.broker_port,"",this.clientId),this.client.disconnect=function(){i.error("[MQTT] Disconnected"),this.srStatus("#7f0000")}.bind(this),this.client.onConnectionLost=function(t){this.srStatus("#ff0000"),i.error("[MQTT] Connection lost: "+t.errorMessage),this.reconnTO&&clearTimeout(this.reconnTO),this.srStatus("orange"),this.reconnTO=setTimeout(this.srConnect.bind(this),5e3)}.bind(this),this.client.onMessageArrived=function(t){if(this.srStatus("#00ff00"),setTimeout(function(){this.srStatus("#007f00")}.bind(this),100),"undefined"!=typeof this.topics[t.destinationName]){var n;for(n=0;n<this.topics[t.destinationName].length;n++){var e=this.topics[t.destinationName][n];try{e.handleUpdate.call(e,t.destinationName,t.payloadString)}catch(n){return i.error("[MQTT] Failure handling update on '"+t.destinationName+"' in class '"+e.constructor.name+": "+n.message),void i.warn(n.stack)}}}else i.warn("[MQTT] Received MQTT message for unexpected topic '"+t.destinationName+"'!");return 1}.bind(this),this.client.connect({onSuccess:function(){i.info("[MQTT] Connected to mqtt://"+this.broker_host+":"+this.broker_port),this.srStatus("#7f0000");var t;for(t in this.topics)this.client.subscribe(t)}.bind(this),onFailure:function(){this.reconnTO&&clearTimeout(this.reconnTO),this.srStatus("orange"),this.reconnTO=setTimeout(this.srConnect.bind(this),5e3)}.bind(this)})},s.prototype.srInit=function(t,n,i){"undefined"==typeof i&&(i="RND"+Math.floor(16777215*Math.random()).toString(16)),this.broker_host=t,this.broker_port=Number(n),this.clientId=i,this.srConnect()},s.getInstance()});
//# sourceMappingURL=dist/MQTT.map