define(["snmd-core/js/Core","snmd-core/js/GUI","js-logger","jquery"],function(t,s,i,a){"use strict";var h=function(t,s,i,h,e){this.opts=i,this.lines=h;var n;if("undefined"!=typeof this.opts.lcls)for(n=0;n<this.lines.length;n++){var l=this.opts.lcls.slice(0),d=function(t){l.push(t+"-"+this.lines[n].name)};this.opts.lcls.forEach(d,this),this.lines[n].style={"class":l.join(" ")}}if("undefined"!=typeof this.opts.mcls&&(this.maxline_style={"class":this.opts.mcls.join(" ")}),this.root=t,i.dim={id:s.id,x:s.x.baseVal.value,y:s.y.baseVal.value,width:s.width.baseVal.value,height:s.height.baseVal.value},t.remove(s),this.rect=t.rect(i.dim.x,i.dim.y,i.dim.width,i.dim.height,{id:i.dim.id,"class":i.cls.base.join(" ")}),"undefined"!=typeof e){var o=a(this.rect);o.addClass("snmd-bcl-Widget"),o.qtip(e)}for(this.txt=[t.text(i.dim.x,i.dim.y,"")],h.length>1&&(this.txt[1]=t.text(i.dim.x+i.dim.width,i.dim.y,"")),n=0;n<this.txt.length;n++)"undefined"!=typeof this.opts.tcls&&this.opts.tcls.forEach(function(t){this.txt[n].classList.add(t),this.txt[n].classList.add(t+"-"+this.lines[n].name)},this);this.data_tswin=(i.dim.width-6)/i.dpi,this.data_ts=[],this.data_lines=[],this.data_svg=[];var r;for(r=0;r<h.length;r++)this.data_lines[r]=[];this.axis_maxlines=[],this.axis_maxlasts=[]};return h.prototype.update=function(a,h,e){this.data_ts.push(a);var n,l="undefined"==typeof this.opts.axis[0].max?0:this.opts.axis[0].max;for(n=0;n<this.data_lines.length;n++)E=h[n],("number"!=typeof E||isNaN(E))&&(E=0),this.data_lines[n].push(E),l=Math.max(l,Math.max.apply(null,this.data_lines[n]));for(var d,o=[];this.data_ts[0]<a-this.data_tswin;)for(d=this.data_ts.shift(),n=0;n<this.data_lines.length;n++)o[n]=this.data_lines[n].shift();if("undefined"!=typeof d&&this.data_ts.length>0){var r=a-this.data_tswin;for(this.data_ts.unshift(r),n=0;n<this.data_lines.length;n++)this.data_lines[n].unshift(o[n]+(this.data_lines[n][0]-o[n])*(r-d)/(this.data_ts[1]-d))}"undefined"!=typeof this.opts.axis[0].max&&this.axis_maxlasts[0]!==l&&(this.axis_maxlasts[0]=l),"log"===this.opts.axis[0].scale&&(l=Math.log10(l));var p=this.opts.dim.x+this.opts.dim.width-3,f=this.opts.dim.y+this.opts.dim.height-3,x=this.opts.dim.height-20,m=x/l,c=[],_=[];if("undefined"!=typeof this.opts.axis[0].max){var u=this.opts.axis[0].max<this.axis_maxlasts[0]?Math.floor(this.axis_maxlasts[0]/this.opts.axis[0].max):0;for(n=0;u>n;n++){"undefined"!=typeof this.axis_maxlines[n]&&c.push(this.axis_maxlines[n]);var g=f-(n+1)*this.opts.axis[0].max*m;this.axis_maxlines[n]=this.root.line(this.opts.dim.x,g,this.opts.dim.x+this.opts.dim.width,g,this.maxline_style)}this.axis_maxlines.length>u&&(c=c.concat(this.axis_maxlines.splice(u,this.axis_maxlines.length-u)))}var y;for(y=0;y<this.data_lines.length;y++){var v=[],w=!0;if("undefined"!=typeof this.data_svg[y]){var b=window.getComputedStyle(this.data_svg[y]);("none"===b.fill||""===b.fill)&&(w=!1)}var j;for(j=0;j<this.data_ts.length;j++){var C=p+(this.data_ts[j]-a)*this.opts.dpi;w&&0===j&&v.push([C,f]);var E=this.data_lines[y][j];"log"===this.opts.axis[0].scale&&(E=E>1?Math.log10(E):0),E*=m,v.push([C,f-E]),j===this.data_ts.length-1&&(w&&v.push([C,f]),_[y]=this.data_lines[y][j])}"undefined"!=typeof this.data_svg[y]&&c.push(this.data_svg[y]);try{this.data_svg[y]=w?this.root.polygon(v,this.lines[y].style):this.root.polyline(v,this.lines[y].style)}catch(M){i.error("[Chart] Failed to create poly for "+this.rect.id)}"undefined"!=typeof this.txt[y]&&(this.txt[y].textContent=t.srSiFormatNum(_[y],"undefined"==typeof this.lines[y].unit?"":this.lines[y].unit,"-"))}for(;c.length;){var L=c.shift();this.root.remove(L)}e!==this.last_state&&(this.opts.cls.state.forEach(function(t){this.rect.classList.remove(t+this.last_state)},this),this.opts.cls.state.forEach(function(t){this.rect.classList.add(t+e)},this),this.last_state=e,s.srStateChanged(this.rect.parentElement.parentElement.id,this.rect.id,e))},h});
//# sourceMappingURL=dist/js/SVGImpl/Chart.map