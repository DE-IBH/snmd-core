define(["snmd-core/Core","snmd-core/HTML","snmd-core/SVG","require","jquery","sprintf","css!../../snmd-core/css/gui.css"],function(e,t,s,i,n,a){"use strict";var r=null,c=function(){if(null!==r)throw new Error("Cannot instantiate more than one instance, use getInstance()!");this.idCounter=0,this.TO_SCREEN=6e5,this.TO_SWITCH=3e4,this.screenState=0,this.viewStates={},this.viewFinalStates={},this.currentStep=0,this.views={},this.views2id={},this.enabledScreenTO=!0,this.enableRotation=!1,this.ctrlButtons={"3d":{title:"Toggle 3D view.",state:0,states:[{facls:"low-vision",cb:function(){this.snmdInit3D(!1)}},{facls:"eye",cb:function(){this.snmdInit3D(!0)}}]},rotate:{title:"Toggle interval or continuous rotation.",state:0,states:[{facls:"repeat",cb:function(){this.enabledScreenTO=!0,this.enableRotation=!1}},{facls:"circle-o-notch",cb:function(){this.enabledScreenTO=!1,this.enableRotation=!1}},{facls:"refresh",cb:function(){this.enabledScreenTO=!1,this.enableRotation=!0,this.srScreenTimeOut()}}]}}};return c.getInstance=function(){return null===r&&(r=new c),r},c.prototype.srScreenTimeOut=function(){var e=i("snmd-core/GUI");return console.info("ScreenTO"),e.enabledScreenTO?(0===e.screenState&&(e.screenState+=1,n(document.body).addClass("on-screensaver")),n(".srViews").each(function(){var t,s=n(this).children(".srViewsNav").find("a"),i=0;for(t=0;t<s.length;t++)s[t].hash===e.currentView&&(i=t);i+=1,i>=s.length&&(i=0),s[i].click()}),void(e.screenTimeOut=window.setTimeout(e.srScreenTimeOut,e.TO_SWITCH))):void(e.screenTimeOut=window.setTimeout(e.srScreenTimeOut,e.TO_SWITCH))},c.prototype.srStateChanged=function(e,t,s){if(this.viewStates[e][t]=s,this.viewFinalStates[e]<s)this.viewFinalStates[e]=s,n("#switch-"+e).css("color",i("snmd-core/Core").srNagStateColor(this.viewFinalStates[e]));else if(this.viewFinalStates[e]>s){var a=s,r=this;Object.keys(this.viewStates[e]).forEach(function(t){r.viewStates[e][t]>a&&(a=r.viewStates[e][t])}),this.viewFinalStates[e]=a,n("#switch-"+e).css("color",i("snmd-core/Core").srNagStateColor(this.viewFinalStates[e]))}},c.prototype.snmdInit3D=function(e){if("undefined"==typeof e&&(e=n(document.body).hasClass("snmd-in-3d")),e){n(document.body).addClass("snmd-in-3d").removeClass("snmd-in-2d");var t=360/Object.keys(this.views).length,s=Object.keys(this.views).length>1?953/Math.tan(Math.PI/Object.keys(this.views).length):0,i=0;Object.keys(this.views).forEach(function(e){n("#"+this.views2id[e]).css("transform","rotateY("+t*i+"deg) translateZ("+s+"px)"),i+=1},this),this.snmdAlignView(s,-t*this.currenStep)}else n(document.body).addClass("snmd-in-2d").removeClass("snmd-in-3d"),Object.keys(this.views).forEach(function(e){n("#"+this.views2id[e]).css("transform","")},this)},c.prototype.snmdAlignView=function(e,t){n(document.body).hasClass("snmd-in-3d")&&n("#snmd-views").css("transform","translateZ(-"+e+"px) rotateY("+t+"deg)")},c.prototype.srInit=function(e){this.views=e;var i=this;n(".srViews").each(function(){var a=n(this).children(".srViewsNav");Object.keys(e).forEach(function(e){this.views2id[e]="srView-"+(this.idCounter+=1).toString(16),this.viewStates[this.views2id[e]]={},this.viewFinalStates[this.views2id[e]]=-1,a.append('<li><a id="switch-'+this.views2id[e]+'" href="#'+this.views2id[e]+'"><span>'+this.views[e].title+"</span></a></li>")},i);var r=n("#snmd-views"),c=360/Object.keys(e).length,o=0,d=Object.keys(e).length>1?953/Math.tan(Math.PI/Object.keys(e).length):0;Object.keys(e).forEach(function(n){switch(r.append('<div class="svgview" id="'+i.views2id[n]+'"></div>'),e[n].render){case"html":t.srLoadHTML(i.views2id[n],i.views[n].url,i.views[n].reload);break;default:s.srLoadSVG(i.views2id[n],i.views[n].url)}o+=1}),i.snmdInit3D(),a.find("a").click(function(){return console.debug("Viewing "+this.hash),i.currentView=this.hash,r.children().removeClass("current").filter(this.hash).removeClass("next").removeClass("prev").addClass("current"),n(i.currentView).prevAll().removeClass("next").addClass("prev"),n(i.currentView).nextAll().removeClass("prev").addClass("next"),a.find("a").removeClass("selected").filter(this).addClass("selected"),i.currenStep=n(i.currentView).prevAll().length,i.snmdAlignView(d,-c*i.currenStep),!1}).filter(":first").click();var h;if(n("#snmd-views").on("transitionend",function(){"undefined"!=typeof h&&(window.clearTimeout(h),h=void 0),i.enableRotation&&(h=window.setTimeout(function(){n(".srViews").each(function(){var e,t=n(this).children(".srViewsNav").find("a"),s=0;for(e=0;e<t.length;e++)t[e].hash===i.currentView&&(s=e);s+=1,s>=t.length&&(s=0),t[s].click()})},5e3))}),"undefined"!==window.location.hash){var l=parseInt(window.location.hash.replace(/^#srView-/,""),10)-1;a.find("a:eq("+l+")").click()}var u=n("ul.snmd-ctrl").empty();Object.keys(i.ctrlButtons).forEach(function(e){var t=i.ctrlButtons[e],s=n("<i></i>").addClass("fa fa-"+t.states[t.state].facls);u.append(n("<li></li>").append(n("<a></a>").attr({title:t.title,href:"#"+e}).append(s).click(function(){return s.removeClass("fa-"+t.states[t.state].facls),t.state=(t.state+1)%t.states.length,s.addClass("fa-"+t.states[t.state].facls),t.states[t.state].cb.call(i),!1})))})},this);var r=n("div#snmd_clock");r&&window.setInterval(function(){var e=new Date,t=-e.getTimezoneOffset(),s=t>=0?"+":"-";t=Math.abs(t);var i=a.sprintf("%d-%02d-%02dT%02d:%02d:%02d%s%02d%02d",e.getFullYear(),e.getMonth()+1,e.getDay(),e.getHours(),e.getMinutes(),e.getSeconds(),s,t/60,t%60);r.text(i)},1e3),this.screenTimeOut=window.setTimeout(this.srScreenTimeOut,this.TO_SCREEN),n(document).mousemove(function(){this.enableRotation||(this.screenState=0,"undefined"!=typeof this.screenTimeOut&&(window.clearTimeout(this.screenTimeOut),this.screenTimeOut=window.setTimeout(this.srScreenTimeOut,this.TO_SCREEN),n(document.body).removeClass("on-screensaver")))}.bind(this)),n(document).keypress(function(e){if(this.screenState=0,"undefined"!=typeof this.screenTimeOut&&(window.clearTimeout(this.screenTimeOut),this.screenTimeOut=window.setTimeout(this.srScreenTimeOut,this.TO_SCREEN)),e.which>47&&e.which<58){var t=48===e.which?"10":String.fromCharCode(e.which);n('a[href="#srView-'+t+'"]').click()}}.bind(this))},c.getInstance()});
//# sourceMappingURL=dist/GUI.map