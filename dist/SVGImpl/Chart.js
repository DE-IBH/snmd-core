define(["snmd-core/Core","snmd-core/GUI"],function(t,s){"use strict";var i=function(t,s,i,a,h){if(this.opts=i,this.lines=a,"undefined"!=typeof this.opts.lcls){var e;for(e=0;e<this.lines.length;e++){var n=this.opts.lcls.slice(0);this.opts.lcls.forEach(function(t){n.push(t+"-"+this.lines[e].name)},this),this.lines[e].style={class:n.join(" ")}}}"undefined"!=typeof this.opts.mcls&&(this.maxline_style={class:this.opts.mcls.join(" ")}),this.root=t,i.dim={id:s.id,x:s.x.baseVal.value,y:s.y.baseVal.value,width:s.width.baseVal.value,height:s.height.baseVal.value},t.remove(s),this.rect=t.rect(i.dim.x,i.dim.y,i.dim.width,i.dim.height,{id:i.dim.id,class:i.cls.base.join(" ")}),"undefined"!=typeof h&&this.rect.qtip(h),this.txt=[t.text(i.dim.x,i.dim.y,"")],a.length>1&&(this.txt[1]=t.text(i.dim.x+i.dim.width,i.dim.y,""));var e;for(e=0;e<this.txt.length;e++)"undefined"!=typeof this.opts.tcls&&this.opts.tcls.forEach(function(t){this.txt[e].classList.add(t),this.txt[e].classList.add(t+"-"+this.lines[e].name)},this);this.data_tswin=(i.dim.width-6)/i.dpi,this.data_ts=[],this.data_lines=[],this.data_svg=[];var l;for(l=0;l<a.length;l++)this.data_lines[l]=[];this.axis_maxlines=[],this.axis_maxlasts=[]};return i.prototype.update=function(i,a,h){this.data_ts.push(i);var e,n="undefined"==typeof this.opts.axis[0].max?0:this.opts.axis[0].max;for(e=0;e<this.data_lines.length;e++)this.data_lines[e].push(a[e]),n=Math.max(n,Math.max.apply(null,this.data_lines[e]));for(var l,d=[];this.data_ts[0]<i-this.data_tswin;)for(l=this.data_ts.shift(),e=0;e<this.data_lines.length;e++)d[e]=this.data_lines[e].shift();if("undefined"!=typeof l&&this.data_ts.length>0){var o=i-this.data_tswin;for(this.data_ts.unshift(o),e=0;e<this.data_lines.length;e++)this.data_lines[e].unshift(d[e]+(this.data_lines[e][0]-d[e])*(o-l)/(this.data_ts[1]-l))}"undefined"!=typeof this.opts.axis[0].max&&this.axis_maxlasts[0]!==n&&(this.axis_maxlasts[0]=n),"log"===this.opts.axis[0].scale&&(n=Math.log10(n));var r=this.opts.dim.x+this.opts.dim.width-3,p=this.opts.dim.y+this.opts.dim.height-3,f=this.opts.dim.height-20,x=f/n,m=[],_=[];if("undefined"!=typeof this.opts.axis[0].max){var c=this.opts.axis[0].max<this.axis_maxlasts[0]?Math.floor(this.axis_maxlasts[0]/this.opts.axis[0].max):0;for(e=0;e<c;e++){"undefined"!=typeof this.axis_maxlines[e]&&m.push(this.axis_maxlines[e]);var u=p-(e+1)*this.opts.axis[0].max*x;this.axis_maxlines[e]=this.root.line(this.opts.dim.x,u,this.opts.dim.x+this.opts.dim.width,u,this.maxline_style)}this.axis_maxlines.length>c&&(m=m.concat(this.axis_maxlines.splice(c,this.axis_maxlines.length-c)))}var g;for(g=0;g<this.data_lines.length;g++){var v=[],y=!0;if("undefined"!=typeof this.data_svg[g]){var w=window.getComputedStyle(this.data_svg[g]);"none"!==w.fill&&""!==w.fill||(y=!1)}var E;for(E=0;E<this.data_ts.length;E++){var b=r+(this.data_ts[E]-i)*this.opts.dpi;y&&0===E&&v.push([b,p]);var M=this.data_lines[g][E];"undefined"==typeof M&&(M=0),isNaN(M)&&(M=0),"log"===this.opts.axis[0].scale&&(M=M>1?Math.log10(M):0),M*=x,v.push([b,p-M]),E===this.data_ts.length-1&&(y&&v.push([b,p]),_[g]=this.data_lines[g][E])}"undefined"!=typeof this.data_svg[g]&&m.push(this.data_svg[g]);try{y?this.data_svg[g]=this.root.polygon(v,this.lines[g].style):this.data_svg[g]=this.root.polyline(v,this.lines[g].style)}catch(t){console.error("Failed to create poly for "+this.rect.id)}"undefined"!=typeof this.txt[g]&&(this.txt[g].textContent=t.srSiFormatNum(_[g],"undefined"==typeof this.lines[g].unit?"":this.lines[g].unit,"-"))}for(;m.length;){var C=m.shift();this.root.remove(C)}h!==this.last_state&&(this.opts.cls.state.forEach(function(t){this.rect.classList.remove(t+this.last_state)},this),this.opts.cls.state.forEach(function(t){this.rect.classList.add(t+h)},this),this.last_state=h,s.srStateChanged(this.rect.parentElement.parentElement.id,this.rect.id,h))},i});
//# sourceMappingURL=dist/SVGImpl/Chart.map